---
prev: /Machine-Vision/
next: /Machine-Vision/Picture-feature-extraction.md
---

# 图像的预处理

新年快乐呀！这个系列是最近十几天再弄的关于机器视觉和深度学习的一些学习笔记，（没错我就是开了一个新坑），不过前面笔记大多数都手写好了，就是得写博客然后敲一下源码。我会尽快更新的，之前的系列我也会陆续补的。


## 前言

这节主要讲的是图像的预处理。

## 颜色空间

我们常见的颜色空间主要有RGB、CMYK、HSV等，有些项目可能会用到一种叫CIE-XYZ的颜色空间，它是基于人类颜色视觉直接测定出来的，应该是最标准的颜色空间。至于它们的特点这边就不赘述了，有需要或者有兴趣的可以自己查一下资料。



## 图像预处理的意义

我们为什么要对图像进行预处理

1. 改善图像的视觉效果
2. 转换为更适合人或者机器处理的形式
3. 突出对人或者机器分析有意义的信息
4. 抑制无用的信息，提高图像的使用价值

具体的说有以下操作：图像锐化、平滑、去噪、灰度调整（对比度增强）


## 图像处理的方法

![图像处理方法](/articles-imgs/20190207/大纲.png "图像处理方法")



## 点运算

- 直方图（Histogram）

  ![直方图](/articles-imgs/20190207/直方图.png "直方图")

  对图片数据/特征分布的一种统计形式。

- 直方图均衡化（HE）

  因为拍照过程产生的问题，照片可能会曝光过度或者不足，导致照片过亮或者过黑。我们就可以通过均衡化重新分配各个灰度单位中的像素点数量，使一定灰度范围像素点数量的值大致相等，从而使亮度在直方图上更好的分布，增强显示效果。**均衡化的实质是对图像进行非线性的拉伸。**

  ![例子1](/articles-imgs/20190207/例子1.png  "例子1")

- 自适应直方图均衡（AHE）

  但是直方图均衡化的经典算法对整幅图像的像素使用相同的变换，如果图像中有明显亮或者暗的区域（局部），处理效果就会比较差。

  而AHE就是针对这个情况进行优化的算法。

  - 移动模板在原始图片上按特定步长滑动
  - 每次移动后，模板区域内做直方图均衡，映射后的结果赋值给模板区域内的所有点
  - 每个点会有多次赋值，最终的值取决于这些赋值的均值

- 限制对比度自适应直方图均衡（CLAHE）

  但是AHE也不是最佳的算法。因为AHE会过度放大图像中相对均匀区域的噪音。所以就有了CLAHE。

  CLAHE不同在于直方图的修剪过程，对直方图进行修剪过后在进行AHE，处理后的图形对比度会更加自然。具体的修剪可以见下图。将超过某个值的那部分像素等面积变换到整个直方图的底部。

  ![例子2](/articles-imgs/20190207/例子2.png  "例子2")

  算法步骤：

  1. 图像分块，以块为单位

  2. 先计算直方图，然后修剪直方图，最后均衡（得到下面中间那个图但是发现块和快之间图像不连续）

  3. 遍历操作各个图像块，进行块间双线性插值（得到下面右图）

  4. 与原图做图层滤色混合操作（可选，如果觉得前三步操作后，觉得图像处理后不够自然可以进行这步操作）

     ![例子3](/articles-imgs/20190207/例子3.png  "例子3")



## 形态学运算

- 膨胀

- 腐蚀

- 开运算（先腐蚀再膨胀，可以去掉目标外的孤立点）

- 闭运算（先膨胀再腐蚀，可以去掉目标内的孔）

  通常，对有噪声的图像进行阈值二值化处理后，所得到的边界是很不平滑的，物体区域内有些错误判断而产生的孔洞，背景区域散布着一些还未被处理的小噪音点，连续的开和闭运算可以显著改善这些情况。



## 邻域运算

- 卷积（或者叫滤波）

  定义：在图片的某个位置`(x,y)`上进行基于邻域的函数计算

  $$h[x,y]=\sum_{k,l}f[k,l]I[x+k,y+l]$$
  
  </br>
  参数解释: 

- x，y是像素在图片中的位置
- k，l是卷积核中的位置
- `h[x,y]`是图片上`（x，y）`像素卷积的结果
- `f[k,l]`是卷积核中在`（k，l）`上的权重参数
- `I[x+k,y+l]`是与`f[k,l]`相对应的图片像素值

  ![卷积](/articles-imgs/20190207/卷积.png  "卷积")

- 边界填充（padding）

  ![卷积1](/articles-imgs/20190207/卷积1.gif  "卷积1")

  从动图中我们容易发现，如果不对边界进行处理的话，卷积得到的图像是会变小的。为了保持不变，就有了边界填充这一操作。

  ![卷积2](/articles-imgs/20190207/卷积2.png "卷积2")

  而补充的类型也有很多

  - 补零（使用的比较多）
  - 边界复制
  - 镜像
  - 块复制

  以下的例子基于7X7卷积：3x3->9X9

  ![卷积3](/articles-imgs/20190207/卷积3.png "卷积3")

  ![卷积4](/articles-imgs/20190207/卷积4.png "卷积4")

  经过上面的例子，我们不难发现，卷积核越大，边界需要补充的越多，所以不要用比较大的卷积去处理较小的图片。

- 滤波类型

  - 均值滤波（效果很差，几乎很少用）

    ![均值滤波](/articles-imgs/20190207/均值滤波.png "均值滤波")

  - 中值滤波（去椒盐噪声效果很好）

    ![中值滤波](/articles-imgs/20190207/中值滤波.png "中值滤波")

  - 高斯滤波（模拟人眼的视觉，关注中心区域；有效去除高斯噪声）

    ![高斯滤波](/articles-imgs/20190207/高斯滤波.png "高斯滤波")

    （高斯滤波是有一个参数σ的，σ越小，关注区域越集中）

  - 梯度Prewitt滤波

    ![梯度Prewitt滤波](/articles-imgs/20190207/梯度Prewitt滤波.png "梯度Prewitt滤波")

  - 梯度Sobel滤波

    ![梯度Sobel滤波](/articles-imgs/20190207/梯度Sobel滤波.png "梯度Sobel滤波")

  - 梯度Laplacian滤波

    ![梯度Laplacian滤波](/articles-imgs/20190207/梯度Laplacian滤波.png "梯度Laplacian滤波")

    作用：

    - 团块检测：周边高于（低于）中心点
    - 边缘检测：像素快速变化的区域

- 高斯金字塔

  - 图像金字塔化：先对图像进行图像平滑，在进行降采样，根据降采样率得到一系列尺寸逐渐减小的图像。
  - 目的：捕捉不同尺寸的物体（就是缩小图片并保持较好的显示效果）

- 拉普拉斯金字塔

  因为在高斯金字塔处理中，高频细节信息在卷积和下采样中丢失，所以通过拉普拉斯金字塔保留所有层所丢失的高频信息，用于图像恢复。

  ![金字塔](/articles-imgs/20190207/金字塔.png "金字塔")



## 傅立叶变换

- 任何一个信号可以由足够多个不同频率和幅值的正余弦波组成

$$ A\sin(wx)+B\cos(wx) $$

 ![傅立叶变换](/articles-imgs/20190207/傅立叶变换.png "傅立叶变换")

关于傅立叶变换没有动图或者视频讲起来特别麻烦（其实也因为我没弄得特别透彻，等我弄透之后我会专门写一篇来说的），这边就暂时没展开细说。后面我会放些链接的，有需要的可以深入了解。

- 基于傅立叶变换的滤波

  - 低（高）通滤波

    ![低通滤波](/articles-imgs/20190207/低通滤波.png "低通滤波")

  - 相位滤波

    ![相位滤波](/articles-imgs/20190207/相位滤波.png "相位滤波")



## 小波变换

::: tip 短时傅立叶变换（STFT）
傅立叶变换假设前提是信号平稳，但是现实中信号大多数是不平稳的，所以STFT通过设置窗格，认为窗格内信号平稳，然后对窗格内的信号分段进行傅立叶变换。但是窗格的大小很难设置。框太窄，频率分辨率差；框太宽，时间分辨率太差。
:::



小波变换基本思路和STFT差不多，但是它将傅立叶变换的基更换了——将无限长的三角函数基换成了有限长的会衰减的小波基。这样子就不仅能获取频率，也能定位到时间。

- 常用的小波函数如下

  - Haar系列，Daubechies系列，Moret系列
  - Sym系列，Meyer系列，Coif系列

  尤其是Haar小波，使用的比较多。

  

------

## 一些链接

- [小波变换](https://www.cnblogs.com/warmbeast/p/7809286.html)
- [傅立叶变换](http://blog.jobbole.com/70549/)